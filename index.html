<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Uni-S ç”Ÿæ´»åœˆ</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ==================== 0. å…¨å±€èˆ‡é‡ç½® ==================== */
    :root { 
      --primary: #06C755; --gold: #C5A674; --bg: #F5F6F7; --text: #333; 
      --tea-sidebar: #F5F5F5;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 0; margin: 0; background-color: var(--bg); color: var(--text); touch-action: manipulation; -webkit-user-select: none; user-select: none; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
    .hidden { display: none !important; }
    #loading { position: fixed; inset: 0; background: #fff; z-index: 2000; display: flex; justify-content: center; align-items: center; color: #999; flex-direction: column; }

    /* é€šç”¨å½ˆçª—é®ç½© */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
    /* åº•éƒ¨æ»‘å‡ºé¢æ¿ */
    .modal-sheet { background: #fff; width: 100%; border-radius: 20px 20px 0 0; max-height: 85vh; overflow-y: auto; animation: slideUp 0.3s; padding-bottom: 20px; position: absolute; bottom: 0; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    /* ==================== 1. åº•éƒ¨å°èˆª (Tab Bar) ==================== */
    #tab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; height: 60px; display: flex; border-top: 1px solid #eee; z-index: 900; padding-bottom: env(safe-area-inset-bottom); flex-shrink: 0; }
    .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #999; font-size: 10px; cursor: pointer; }
    .tab-item.active { color: var(--primary); font-weight: bold; }
    .tab-icon { font-size: 22px; margin-bottom: 3px; }

    /* ==================== 2. ä¸»è¦–åœ–å®¹å™¨ (å¤§å»³/æœƒå“¡/é ˜åˆ¸) ==================== */
    .scroll-view { flex: 1; overflow-y: auto; padding-bottom: 80px; -webkit-overflow-scrolling: touch; }

    /* å¤§å»³æ¨£å¼ */
    .lobby-header-bg { background: linear-gradient(135deg, #2c3e50, #000); height: 160px; border-radius: 0 0 20px 20px; padding: 20px; color: var(--gold); }
    .float-member-card { background: #fff; margin: -80px 15px 15px 15px; border-radius: 12px; padding: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); display: flex; align-items: center; cursor: pointer; }
    .mini-avatar { width: 50px; height: 50px; border-radius: 50%; margin-right: 12px; background: #eee; }
    .quick-points { margin-left: auto; text-align: center; border-left: 1px solid #eee; padding-left: 15px; }
    .quick-points .num { font-size: 20px; font-weight: bold; color: var(--gold); }
    
    .search-bar { margin: 0 15px 15px 15px; background: #fff; padding: 10px; border-radius: 20px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .search-bar input { border: none; flex: 1; outline: none; margin-left: 10px; font-size: 14px; }
    .shop-card { background: #fff; border-radius: 12px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); display: flex; padding: 10px; cursor: pointer; }
    .shop-thumb { width: 80px; height: 80px; border-radius: 8px; background-size: cover; background-position: center; flex-shrink: 0; }
    .shop-info { padding-left: 15px; flex: 1; display: flex; flex-direction: column; justify-content: center; }
    .btn-visit { background: #333; color: var(--gold); border: none; padding: 4px 12px; border-radius: 20px; font-size: 12px; width: fit-content; }

    /* æœƒå“¡ä¸­å¿ƒæ¨£å¼ */
    .member-header-bg { background-color: var(--bg); height: 80px; }
    .premium-card { margin: -60px 15px 15px 15px; background: linear-gradient(135deg, #2b2b2b, #1a1a1a); border-radius: 16px; padding: 20px; color: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.15); position: relative; overflow: hidden; }
    .card-user-row { display: flex; align-items: center; margin-bottom: 25px; }
    .card-avatar { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--gold); margin-right: 12px; }
    .card-stats-row { display: flex; justify-content: space-between; text-align: center; }
    .stat-num { font-size: 20px; font-weight: bold; display: block; margin-bottom: 4px; }
    
    /* ä¿®å¾©: è£œå›æœå‹™å€å¡Šæ¨£å¼ */
    .service-section { background: #fff; margin: 0 15px 15px 15px; border-radius: 12px; padding: 20px 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
    .service-item { text-align: center; cursor: pointer; }
    .service-icon { font-size: 24px; color: #555; margin-bottom: 5px; }
    .service-label { font-size: 11px; color: #666; }

    .history-simple-item { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.02); cursor: pointer; }
    .status-wait { background: #FFF3E0; color: #F57C00; padding:2px 6px; border-radius:4px; font-size:12px; }
    .status-ok { background: #E8F5E9; color: #388E3C; padding:2px 6px; border-radius:4px; font-size:12px; }
    .status-no { background: #FFEBEE; color: #D32F2F; padding:2px 6px; border-radius:4px; font-size:12px; }

    /* ==================== 3. åº—é‹ªé é¢ (Shop) - é›™æ¨¡å¼æ•´åˆä¿®å¾©ç‰ˆ ==================== */
    #shop-view { background: #fff; height: 100%; display: flex; flex-direction: column; position: relative; z-index: 50; }
    
    /* Banner å€åŸŸ (æ¢å¾©åŸç‰ˆè¦–è¦º) */
    .shop-banner-area { width: 100%; height: 180px; background-size: cover; background-position: center; position: relative; flex-shrink: 0; }
    .shop-banner-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.7)); display: flex; align-items: flex-end; padding: 15px; }
    .shop-title-large { color: #fff; font-size: 22px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    
    .float-back { position: absolute; top: 15px; left: 15px; width: 36px; height: 36px; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; z-index: 200; cursor: pointer; }

    /* åŠŸèƒ½æ§åˆ¶åˆ— (æ–°ç‰ˆåŠŸèƒ½) */
    .shop-controls { background: #fff; padding: 10px 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 20; flex-shrink: 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
    .delivery-toggle { display: flex; background: #f0f0f0; border-radius: 20px; padding: 2px; }
    .toggle-btn { padding: 4px 12px; border-radius: 18px; border: none; font-size: 12px; background: transparent; color: #666; }
    .toggle-btn.active { background: var(--primary); color: #fff; font-weight: bold; }
    
    /* èœå–®å®¹å™¨ */
    .shop-body { flex: 1; display: flex; overflow: hidden; position: relative; background: #fff; }
    
    /* A. èŒ¶é£²æ¨¡å¼ (Sidebar) */
    .menu-sidebar { width: 85px; background: #F5F5F5; overflow-y: auto; scrollbar-width: none; padding-bottom: 80px; }
    .category-item { padding: 18px 5px; font-size: 13px; color: #666; text-align: center; cursor: pointer; position: relative; }
    .category-item.active { background: #fff; color: #333; font-weight: bold; }
    .category-item.active::before { content: ''; position: absolute; left: 0; top: 15px; bottom: 15px; width: 4px; background: var(--primary); border-radius: 0 4px 4px 0; }
    
    .menu-content { flex: 1; overflow-y: auto; padding: 0 10px 80px 10px; scroll-behavior: smooth; }
    .category-title { font-size: 13px; font-weight: bold; color: #333; margin: 15px 0 10px 0; padding-left: 5px; }
    .food-item { display: flex; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
    .food-item:last-child { border-bottom: none; }
    .food-img { width: 90px; height: 90px; border-radius: 8px; background-color: #eee; background-size: cover; background-position: center; flex-shrink: 0; }
    .food-info { flex: 1; padding-left: 10px; display: flex; flex-direction: column; justify-content: space-between; }
    .food-name { font-size: 16px; font-weight: bold; color: #333; }
    .food-desc { font-size: 11px; color: #999; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-top: 4px;}
    .food-action { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 5px; }
    .food-price { color: var(--primary); font-weight: bold; }
    .btn-add-mini { background: var(--primary); color: #fff; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; }

    /* B. é›¶å”®æ¨¡å¼ (Grid) */
    .retail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; width: 100%; overflow-y: auto; align-content: flex-start; padding-bottom: 80px; }
    .retail-item { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #eee; display: flex; flex-direction: column; }
    .retail-img { height: 140px; background-color: #eee; background-size: cover; background-position: center; }
    .retail-info { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
    .stepper-mini { display: flex; align-items: center; background: #f5f5f5; border-radius: 20px; }
    .stepper-mini button { width: 24px; height: 24px; border: none; background: transparent; font-size: 12px; display:flex; align-items:center; justify-content:center; }

    /* è³¼ç‰©è»Šæ¢ */
    .cart-bar { position: absolute; bottom: 20px; left: 15px; right: 15px; background: #333; border-radius: 50px; padding: 0; display: flex; justify-content: space-between; align-items: center; color: #fff; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 100; height: 50px; cursor: pointer; }
    .cart-left { flex: 1; display: flex; align-items: center; padding-left: 20px; height: 100%; }
    .cart-badge { position: absolute; top: -8px; right: -8px; background: #D32F2F; color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 10px; }
    .btn-checkout { background: var(--primary); color: #fff; border: none; height: 100%; padding: 0 30px; border-radius: 0 50px 50px 0; font-weight: bold; font-size: 16px; display: flex; align-items: center; }

    /* ==================== 4. å„ç¨®å½ˆçª— ==================== */
    /* è³¼ç‰©è»Šæ˜ç´° */
    .cart-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #fff; border-bottom: 1px solid #f5f5f5; border-radius: 20px 20px 0 0; }
    .cart-stepper { display: flex; align-items: center; background: #f5f5f5; border-radius: 20px; }
    .cart-stepper button { width: 32px; height: 32px; border: none; background: transparent; font-size: 14px; display: flex; align-items: center; justify-content: center; color: #666; }
    .cart-stepper span { font-weight: bold; margin: 0 8px; font-size: 14px; min-width: 20px; text-align: center; }

    .cart-list { padding: 0 15px; max-height: 50vh; overflow-y: auto; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f5f5f5; }
    
    /* è¦æ ¼é¸æ“‡ */
    .spec-header { padding: 15px; display: flex; gap: 15px; }
    .spec-img { width: 80px; height: 80px; border-radius: 8px; background-color: #eee; background-size: cover; background-position: center; }
    .spec-options { padding: 0 15px 15px 15px; max-height: 40vh; overflow-y: auto; }
    .chip { padding: 6px 15px; background: #F5F5F5; border-radius: 6px; font-size: 12px; color: #333; border: 1px solid transparent; cursor: pointer; margin-right: 5px; margin-bottom: 5px; display: inline-block; }
    .chip.selected { background: #FEF0F0; color: var(--primary); border-color: var(--primary); }
    .spec-add-btn { background: var(--primary); color: #fff; padding: 10px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; text-align: center; }
    .stepper { display: flex; align-items: center; background: #f5f5f5; border-radius: 20px; padding: 2px 8px; }
    
    /* è¨‚å–®è©³æƒ… (ç¨ç«‹é ) */
    #order-detail-view { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #F5F6F7; z-index: 950; overflow-y: auto; display: flex; flex-direction: column; }
    .od-navbar { background: #fff; padding: 15px; display: flex; align-items: center; font-weight: bold; position: sticky; top: 0; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .od-card { background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    
    /* æœå‹™é¸æ“‡ */
    .service-option { padding: 15px; border: 2px solid #eee; border-radius: 12px; font-weight: bold; text-align: center; cursor: pointer; margin-bottom: 10px; }
    .service-option.selected { border-color: var(--primary); color: var(--primary); background: rgba(6, 199, 85, 0.05); }

    /* ç·¨è¼¯è³‡æ–™ */
    .modal-content-center { background: #fff; width: 80%; border-radius: 16px; padding: 20px; }
    .form-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
    
    /* è¨Šæ¯å½ˆçª—æ¨£å¼ (å¾©åˆ»åŸç‰ˆ) */
    .msg-box { background: white; width: 80%; max-width: 320px; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: popIn 0.2s ease-out; }
    .msg-icon { font-size: 40px; margin-bottom: 15px; color: var(--primary); }
    .msg-text { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 20px; }
    .msg-btns { display: flex; gap: 10px; justify-content: center; }
    .msg-btn { flex: 1; padding: 12px; border-radius: 30px; font-size: 16px; font-weight: bold; border: none; cursor: pointer; }
    .msg-btn-ok { background: var(--primary); color: white; }
    .msg-btn-cancel { background: #eee; color: #666; }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  </style>
</head>
<body>

  <div id="loading">Uni-S è¼‰å…¥ä¸­...</div>

  <div id="msg-modal-overlay" class="modal-overlay hidden" style="z-index: 2000;">
    <div class="msg-box">
      <div id="msg-icon" class="msg-icon"><i class="fas fa-check-circle"></i></div>
      <div id="msg-text" class="msg-text">...</div>
      <div class="msg-btns">
        <button id="msg-btn-no" class="msg-btn msg-btn-cancel hidden" onclick="closeMsgModal(false)">å–æ¶ˆ</button>
        <button id="msg-btn-yes" class="msg-btn msg-btn-ok" onclick="closeMsgModal(true)">ç¢ºå®š</button>
      </div>
    </div>
  </div>

  <div id="lobby-view" class="scroll-view hidden">
    <div class="lobby-header-bg"><div style="font-weight:bold; letter-spacing:1px; font-size:12px; opacity:0.8;">UNI-S PLATFORM</div><div style="font-size:20px; font-weight:bold; margin-top:5px; color:#fff;">æ¢ç´¢ç¾å¥½ç”Ÿæ´»</div></div>
    <div class="float-member-card" onclick="switchTab('member')"><img id="home-avatar" src="" class="mini-avatar"><div class="user-greeting"><h3><span id="home-name">...</span></h3><p>é»æ“ŠæŸ¥çœ‹æœƒå“¡æ¬Šç›Š â€º</p></div><div class="quick-points"><span class="num" id="home-points">0</span><span class="label">ç©åˆ†</span></div></div>
    <div class="search-bar"><i class="fas fa-search" style="color:#999; margin-right:5px;"></i><input type="text" id="search-input" placeholder="æœå°‹åº—å®¶..." oninput="filterShops()"></div>
    <div id="shop-list" style="padding: 10px 15px;"></div>
  </div>

  <div id="coupons-view" class="scroll-view hidden">
    <div style="padding:20px 15px; font-weight:bold; font-size:18px;">é ˜åˆ¸ä¸­å¿ƒ</div>
    <div style="padding:0 15px; text-align:center; color:#999;">å„ªæƒ åˆ¸åŠŸèƒ½é–‹ç™¼ä¸­...</div>
  </div>

  <div id="member-view" class="scroll-view hidden">
    <div class="member-header-bg"></div>
    <div class="premium-card">
      <div class="card-user-row"><img id="m-avatar" src="" class="mini-avatar" style="border:2px solid var(--gold);"><div style="flex:1;"><div id="m-name" style="font-size:18px;font-weight:bold;color:var(--gold);">...</div><div style="font-size:12px;background:linear-gradient(to right,#C5A674,#E5C690);color:#000;padding:2px 8px;border-radius:10px;display:inline-block;margin-top:4px;">æ™®é€šæœƒå“¡</div></div><i class="fas fa-edit" onclick="openEditModal()" style="font-size:20px;color:var(--gold);opacity:0.8;cursor:pointer;"></i></div>
      <div class="card-stats-row"><div class="stat-box"><span class="stat-num">0</span><span style="font-size:11px;color:rgba(255,255,255,0.6);">é¤˜é¡</span></div><div class="stat-box" style="border-left:1px solid rgba(255,255,255,0.1); border-right:1px solid rgba(255,255,255,0.1);"><span class="stat-num" id="m-points">0</span><span style="font-size:11px;color:rgba(255,255,255,0.6);">ç©åˆ†</span></div><div class="stat-box"><span class="stat-num">2</span><span style="font-size:11px;color:rgba(255,255,255,0.6);">å„ªæƒ åˆ¸</span></div></div>
    </div>
    
    <!-- è£œå›: æœå‹™å€å¡Š -->
    <div class="service-section">
      <div class="service-item" onclick="showMsg('ç©åˆ†å…Œæ›åŠŸèƒ½é–‹ç™¼ä¸­')"><div class="service-icon"><i class="fas fa-gift"></i></div><div class="service-label">ç©åˆ†å…Œæ›</div></div>
      <div class="service-item" onclick="showMsg('å®¢æœé€£ç·šä¸­...')"><div class="service-icon"><i class="fas fa-headset"></i></div><div class="service-label">è¯ç¹«å®¢æœ</div></div>
      <div class="service-item" onclick="showMsg('å¸¸è¦‹å•é¡Œé é¢')"><div class="service-icon"><i class="fas fa-question-circle"></i></div><div class="service-label">å¸¸è¦‹å•é¡Œ</div></div>
      <div class="service-item" onclick="showMsg('Uni-S v1.1')"><div class="service-icon"><i class="fas fa-info-circle"></i></div><div class="service-label">é—œæ–¼æˆ‘å€‘</div></div>
    </div>

    <div class="history-section" style="padding:0 15px;">
      <div style="font-weight:bold; margin-bottom:10px;">æœ€è¿‘è¨‚å–®</div>
      <div id="history-loading" style="text-align:center; color:#999; font-size:12px;">è¼‰å…¥ä¸­...</div>
      <div id="history-list"></div>
    </div>
  </div>

  <div id="shop-view" class="hidden">
    <!-- è£œå›: Banner å¤§åœ–å€ -->
    <div id="shop-banner" class="shop-banner-area">
        <div class="shop-banner-overlay">
            <h1 class="shop-title-large" id="shop-name-title">...</h1>
        </div>
        <div class="float-back" onclick="goLobby()"><i class="fas fa-chevron-left"></i></div>
    </div>
    
    <!-- æ§åˆ¶åˆ— -->
    <div class="shop-controls">
      <div class="store-info-text" style="font-size:14px; color:#666;"><i class="fas fa-clock"></i> ç‡Ÿæ¥­ä¸­</div>
      <div class="delivery-toggle"><button class="toggle-btn active">è‡ªå–</button><button class="toggle-btn">å¤–é€</button></div>
    </div>
    
    <div class="shop-body">
      <!-- é¤é£²/èŒ¶é£²æ¨¡å¼å´é‚Šæ¬„ -->
      <div class="menu-sidebar" id="food-sidebar" style="display:none;"></div>
      <!-- é¤é£²å…§å®¹ -->
      <div class="menu-content" id="food-content" style="display:none;"></div>
      <!-- é›¶å”®æ¨¡å¼ç¶²æ ¼ -->
      <div id="mode-retail" class="retail-grid" style="display:none;"></div>
    </div>
    
    <div id="cart-bar" class="cart-bar" style="display:none;">
      <div class="cart-left" onclick="openCartModal()">
        <div style="position:relative;margin-right:15px;"><i class="fas fa-shopping-bag" style="font-size:24px;"></i><div class="cart-badge" id="cart-count">0</div></div>
        <div style="font-size:18px;font-weight:bold;">$<span id="cart-total">0</span></div>
      </div>
      <div class="btn-checkout" onclick="preCheckout()">å»çµç®—</div>
    </div>
  </div>

  <div id="order-detail-view" class="hidden">
    <div class="od-navbar"><div style="font-size:20px;width:30px;cursor:pointer;" onclick="closeOrderDetail()"><i class="fas fa-chevron-left"></i></div><div style="flex:1;text-align:center;margin-right:30px;">è¨‚å–®è©³æƒ…</div></div>
    <div class="od-content" style="padding:15px;">
      <div class="od-card">
        <div class="od-shop-header" style="font-size:18px;font-weight:bold;margin-bottom:10px;"><span id="od-shop-name">...</span></div>
        <div style="display:flex;justify-content:space-between;font-size:13px;color:#666;"><span>ç‹€æ…‹</span><span id="od-status" style="font-weight:bold;">...</span></div>
      </div>
      <div class="od-card">
        <div style="font-weight:bold;margin-bottom:10px;">é¤é»æ˜ç´°</div>
        <div id="od-items-list"></div>
        <div style="text-align:right;margin-top:10px;font-weight:bold;color:#D32F2F;">åˆè¨ˆ <span id="od-total-price">...</span></div>
      </div>
      <div class="od-card">
        <div style="font-weight:bold;margin-bottom:10px;">è¨‚å–®è³‡è¨Š</div>
        <div style="font-size:13px;color:#666;">ç·¨è™Ÿï¼š<span id="od-id"></span></div>
        <div style="font-size:13px;color:#666;">æ™‚é–“ï¼š<span id="od-time"></span></div>
        <div style="font-size:13px;color:#666;">é›»è©±ï¼š<span id="od-phone"></span></div>
      </div>
      <div id="od-cancel-container" style="margin-top:20px;"></div>
    </div>
  </div>

  <div id="cart-modal" class="modal-overlay hidden" onclick="closeCartModal()">
    <div class="modal-sheet" style="padding:0;" onclick="event.stopPropagation()">
      <div class="cart-header">
         <div style="font-weight:bold;font-size:16px;">è³¼ç‰©è»Šå…§å®¹</div>
         <div onclick="closeCartModal()" style="cursor:pointer;padding:5px;"><i class="fas fa-chevron-down"></i></div>
      </div>
      <div style="background:#f9f9f9;padding:8px 15px;font-size:12px;color:#666;display:flex;justify-content:space-between;align-items:center;">
          <span>å·²é¸å•†å“</span>
          <span onclick="clearCart()" style="cursor:pointer;color:#999;"><i class="fas fa-trash"></i> æ¸…ç©º</span>
      </div>
      <div id="cart-list" class="cart-list"></div>
      <div style="height:20px;"></div>
    </div>
  </div>
  <div id="spec-modal" class="modal-overlay hidden">
    <div class="modal-sheet">
      <div style="text-align:right;padding:10px;"><i class="fas fa-times" onclick="closeSpecModal()" style="font-size:24px;color:#999;cursor:pointer;"></i></div>
      <div class="spec-header"><div class="spec-img" id="sp-img"></div><div><div style="font-size:18px;font-weight:bold;" id="sp-name"></div><div style="font-size:12px;color:#888;" id="sp-desc"></div></div></div>
      <div id="sp-options" class="spec-options"></div>
      <div class="spec-footer" style="padding:15px; border-top:1px solid #eee;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;">
           <div style="font-size:20px;font-weight:bold;color:#333;">$<span id="sp-price">0</span></div>
           <div class="stepper"><button onclick="updateSpQty(-1)">-</button><span id="sp-qty" style="margin:0 10px;font-weight:bold;">1</span><button onclick="updateSpQty(1)">+</button></div>
        </div>
        <div class="spec-add-btn" onclick="addSpecToCart()">åŠ å…¥è³¼ç‰©è»Š</div>
      </div>
    </div>
  </div>
  <div id="service-modal" class="modal-overlay hidden">
    <div class="modal-sheet">
      <div style="padding:20px;">
        <div style="text-align:center;font-weight:bold;font-size:18px;margin-bottom:20px;">é¸æ“‡æœå‹™æ–¹å¼</div>
        <div id="service-options"></div>
        <div class="spec-add-btn" style="text-align:center;margin-top:15px;" onclick="confirmOrder()">ç¢ºèªä¸‹å–®</div>
        <div style="text-align:center;margin-top:15px;color:#999;cursor:pointer;" onclick="document.getElementById('service-modal').classList.add('hidden')">å–æ¶ˆ</div>
      </div>
    </div>
  </div>
  <div id="edit-modal" class="modal-overlay hidden">
    <div class="modal-content-center">
      <div style="text-align:center;font-weight:bold;margin-bottom:15px;">ç·¨è¼¯è³‡æ–™</div>
      <div style="margin-bottom:10px;"><label style="font-size:12px;color:#666;">å§“å</label><input type="text" id="edit-name" class="form-input"></div>
      <div style="margin-bottom:10px;"><label style="font-size:12px;color:#666;">é›»è©±</label><input type="tel" id="edit-phone" class="form-input"></div>
      <div style="margin-bottom:15px;"><label style="font-size:12px;color:#666;">ç”Ÿæ—¥</label><input type="date" id="edit-birthday" class="form-input"></div>
      <div style="display:flex;gap:10px;"><div style="flex:1;text-align:center;padding:10px;background:#eee;border-radius:20px;" onclick="closeEditModal()">å–æ¶ˆ</div><div class="btn-save" style="flex:1;text-align:center;padding:10px;background:var(--primary);color:#fff;border-radius:20px;font-weight:bold;cursor:pointer;" onclick="saveProfile()">å„²å­˜</div></div>
    </div>
  </div>

  <div id="tab-bar">
    <div class="tab-item active" onclick="switchTab('lobby')"><div class="tab-icon"><i class="fas fa-home"></i></div><div>é¦–é </div></div>
    <div class="tab-item" onclick="switchTab('coupons')"><div class="tab-icon"><i class="fas fa-ticket-alt"></i></div><div>å„ªæƒ </div></div>
    <div class="tab-item" onclick="switchTab('member')"><div class="tab-icon"><i class="fas fa-user"></i></div><div>æˆ‘çš„</div></div>
  </div>

  <script>
    // âš ï¸âš ï¸âš ï¸ è¨­å®šå€ âš ï¸âš ï¸âš ï¸
    const MY_LIFF_ID = "2008590518-p2AoVQO2"; 
    const API_URL = "https://script.google.com/macros/s/AKfycbzxUYXVSMjF8Zt7KqBo9qGvottN4zoxkM1qCu97ZqugJ7Nf6czxu0DzBY9DN1nVRtdn/exec";

    // ç‹€æ…‹
    let allShops = {}; let currentShop = null; let cart = []; 
    let userProfile = null; let orderCache = []; let selectedService = "";
    let currentItem = null; let currentOptions = {}; let currentQty = 1;

    // å½ˆçª—
    let modalCb = null;
    function showMsg(txt, cb) { 
      document.getElementById('msg-text').innerText = txt; 
      document.getElementById('msg-btn-no').classList.add('hidden'); 
      document.getElementById('msg-modal-overlay').classList.remove('hidden'); 
      modalCb = cb; 
    }
    function showConfirm(txt, cb) {
      document.getElementById('msg-text').innerText = txt;
      document.getElementById('msg-btn-no').classList.remove('hidden');
      document.getElementById('msg-modal-overlay').classList.remove('hidden');
      modalCb = cb;
    }
    function closeMsgModal(isYes) {
      document.getElementById('msg-modal-overlay').classList.add('hidden');
      if(isYes && modalCb) modalCb();
      modalCb = null;
    }

    async function main() {
      try {
        await liff.init({ liffId: MY_LIFF_ID });
        if (!liff.isLoggedIn()) { liff.login(); return; }
        userProfile = await liff.getProfile();
        updateUI();

        const res = await fetch(API_URL);
        allShops = await res.json();
        document.getElementById('loading').classList.add('hidden');

        const params = new URLSearchParams(window.location.search);
        if (params.get('id') && allShops[params.get('id')]) openShop(params.get('id'));
        else if (params.get('tab') === 'member') { renderLobby(allShops); switchTab('member'); }
        else { renderLobby(allShops); switchTab('lobby'); }
        
        fetchMemberData();
      } catch (err) { showMsg(err.message); }
    }

    function updateUI() {
      ['home-name','m-name'].forEach(id => document.getElementById(id).innerText = userProfile.displayName);
      ['home-avatar','m-avatar'].forEach(id => document.getElementById(id).src = userProfile.pictureUrl);
    }

    function switchTab(tab) {
      ['lobby-view', 'coupons-view', 'member-view', 'shop-view', 'order-detail-view'].forEach(id => document.getElementById(id).classList.add('hidden'));
      document.getElementById('tab-bar').classList.remove('hidden');
      document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
      
      if (tab === 'lobby') {
        document.getElementById('lobby-view').classList.remove('hidden');
        document.querySelectorAll('.tab-item')[0].classList.add('active');
        fetchMemberData();
      } else if (tab === 'coupons') {
        document.getElementById('coupons-view').classList.remove('hidden');
        document.querySelectorAll('.tab-item')[1].classList.add('active');
      } else if (tab === 'member') {
        document.getElementById('member-view').classList.remove('hidden');
        document.querySelectorAll('.tab-item')[2].classList.add('active');
        fetchMemberData();
        loadOrderHistory();
      }
    }

    // ========== æ ¸å¿ƒåŠŸèƒ½ ==========
    function openShop(id) {
      currentShop = allShops[id]; currentShop.id = id; cart = []; updateCartUI();
      const url = new URL(window.location); url.searchParams.set('id', id); window.history.pushState({}, '', url);
      
      document.getElementById('tab-bar').classList.add('hidden');
      ['lobby-view','coupons-view','member-view'].forEach(id=>document.getElementById(id).classList.add('hidden'));
      document.getElementById('shop-view').classList.remove('hidden');
      
      // è¨­å®š Banner èˆ‡æ¨™é¡Œ (ä¿®å¾©: æ¢å¾©é¡¯ç¤º)
      document.getElementById('shop-name-title').innerText = currentShop.name;
      document.getElementById('shop-banner').style.backgroundImage = `url(${currentShop.bannerUrl})`;

      if (currentShop.type === 'retail') {
        document.getElementById('food-sidebar').style.display = 'none';
        document.getElementById('food-content').style.display = 'none';
        document.getElementById('mode-retail').style.display = 'grid';
        renderRetailMenu();
      } else {
        document.getElementById('mode-retail').style.display = 'none';
        document.getElementById('food-sidebar').style.display = 'block';
        document.getElementById('food-content').style.display = 'block';
        renderFoodMenu();
      }
    }

    function renderFoodMenu() {
      const catList = document.getElementById('food-sidebar');
      const prodList = document.getElementById('food-content');
      catList.innerHTML = ''; prodList.innerHTML = '';
      let menu = Array.isArray(currentShop.menu) && currentShop.menu[0].category ? currentShop.menu : [{category:"å…¨éƒ¨", items:currentShop.menu}];
      
      menu.forEach((cat, idx) => {
        catList.innerHTML += `<div class="category-item ${idx===0?'active':''}" id="cat-btn-${idx}" onclick="document.getElementById('cat-sec-${idx}').scrollIntoView({behavior:'smooth'})">${cat.category}</div>`;
        let itemsHtml = '';
        cat.items.forEach(item => {
          let itemJson = JSON.stringify(item).replace(/"/g, '&quot;');
          itemsHtml += `<div class="food-item" onclick="openSpecModal(${itemJson})"><div class="food-img" style="background-image:url(${item.img||currentShop.bannerUrl})"></div><div class="food-info"><div><div class="food-name">${item.name}</div><div class="food-desc">${item.desc||''}</div></div><div class="food-action"><div class="food-price">$${item.price}</div><div class="btn-add-mini">+</div></div></div></div>`;
        });
        prodList.innerHTML += `<div id="cat-sec-${idx}" class="cat-section"><div class="category-title" style="margin:15px 0 10px 0;font-weight:bold;color:#333;">${cat.category}</div>${itemsHtml}</div>`;
      });
      prodList.onscroll = function() {
        const secs = document.querySelectorAll('.cat-section');
        secs.forEach((sec,i) => { if(sec.offsetTop - prodList.offsetTop <= prodList.scrollTop + 50) { document.querySelectorAll('.category-item').forEach(e=>e.classList.remove('active')); document.getElementById(`cat-btn-${i}`).classList.add('active'); } });
      };
    }

    function renderRetailMenu() {
      let html = '';
      currentShop.menu.forEach((item, idx) => {
        let img = item.img || currentShop.bannerUrl;
        html += `<div class="retail-item"><div class="retail-img" style="background-image:url(${img})"></div><div class="retail-info"><div style="font-weight:bold;font-size:14px;">${item.name}</div><div class="retail-actions" style="display:flex;justify-content:space-between;align-items:center;"><span style="color:#e64a19;font-weight:bold;">$${item.price}</span><div class="stepper-mini"><button onclick="updateCartRetail('${item.name}', ${item.price}, -1)">-</button><span id="r-qty-${idx}" style="font-size:13px;font-weight:bold;margin:0 5px;">0</span><button onclick="updateCartRetail('${item.name}', ${item.price}, 1)">+</button></div></div></div></div>`;
      });
      document.getElementById('mode-retail').innerHTML = html;
    }

    // è³¼ç‰©è»Š & å½ˆçª—
    function openSpecModal(item) {
      currentItem = item; currentQty = 1; currentOptions = {};
      document.getElementById('sp-name').innerText = item.name;
      document.getElementById('sp-desc').innerText = item.desc||'';
      document.getElementById('sp-price').innerText = item.price;
      document.getElementById('sp-img').style.backgroundImage = `url(${item.img||currentShop.bannerUrl})`;
      document.getElementById('sp-qty').innerText = 1;
      let html = '';
      for (let [k, vals] of Object.entries(item.options||{})) {
        currentOptions[k] = vals[0];
        let chips = vals.map((v,i) => `<div class="chip ${i===0?'selected':''}" onclick="selOpt(this,'${k}','${v}')">${v}</div>`).join('');
        html += `<div class="option-group"><div class="option-title" style="margin-bottom:8px;font-size:13px;color:#666;">${k}</div><div class="option-chips" style="display:flex;gap:8px;flex-wrap:wrap;">${chips}</div></div>`;
      }
      document.getElementById('sp-options').innerHTML = html || '<div style="color:#999;font-size:12px;">ç„¡è¦æ ¼é¸é …</div>';
      document.getElementById('spec-modal').classList.remove('hidden');
    }
    function selOpt(el, k, v) { el.parentNode.querySelectorAll('.chip').forEach(c=>c.classList.remove('selected')); el.classList.add('selected'); currentOptions[k] = v; }
    function updateSpQty(n) { if(currentQty+n>0) { currentQty+=n; document.getElementById('sp-qty').innerText=currentQty; document.getElementById('sp-price').innerText=currentItem.price*currentQty; } }
    function addSpecToCart() {
      let opts = Object.values(currentOptions).join('/'); if(opts) opts = `(${opts})`;
      cart.push({name: currentItem.name + " " + opts, price: currentItem.price, qty: currentQty, total: currentItem.price*currentQty});
      document.getElementById('spec-modal').classList.add('hidden');
      updateCartUI();
    }
    function updateCartRetail(name, price, change) {
      let exist = cart.find(x => x.name === name);
      if(exist) { exist.qty += change; if(exist.qty<=0) cart = cart.filter(x=>x.name!==name); else exist.total = exist.price*exist.qty; }
      else if(change>0) cart.push({name:name, price:price, qty:1, total:price, opts:""});
      updateCartUI();
      currentShop.menu.forEach((item,idx) => { let el = document.getElementById(`r-qty-${idx}`); let inCart = cart.find(x=>x.name===item.name); if(el) el.innerText = inCart?inCart.qty:0; });
    }
    function updateCartUI() {
      let totalQty = cart.reduce((a,b)=>a+b.qty,0);
      let totalPrice = cart.reduce((a,b)=>a+b.total,0);
      if(totalQty > 0) { document.getElementById('cart-bar').style.display = 'flex'; document.getElementById('cart-count').innerText = totalQty; document.getElementById('cart-total').innerText = totalPrice; } 
      else { document.getElementById('cart-bar').style.display = 'none'; closeCartModal(); }
    }
    function openCartModal() {
      if(cart.length===0) { closeCartModal(); return; }
      const list = document.getElementById('cart-list');
      let html = '';
      cart.forEach((item, idx) => {
        html += `
        <div class="cart-item">
            <div style="flex:1;">
                <div style="font-size:15px;font-weight:bold;margin-bottom:4px;">${item.name}</div>
                <div style="font-size:12px;color:#999;">$${item.price}</div>
            </div>
            <div style="display:flex;align-items:center;gap:15px;">
                <div style="font-weight:bold;min-width:40px;text-align:right;">$${item.total}</div>
                <div class="cart-stepper">
                    <button onclick="updateCartItemQty(${idx}, -1)"><i class="fas fa-minus"></i></button>
                    <span>${item.qty}</span>
                    <button onclick="updateCartItemQty(${idx}, 1)"><i class="fas fa-plus"></i></button>
                </div>
            </div>
        </div>`;
      });
      list.innerHTML = html;
      document.getElementById('cart-modal').classList.remove('hidden');
    }

    function updateCartItemQty(idx, change) {
        let item = cart[idx];
        if(!item) return;
        
        item.qty += change;
        
        if(item.qty <= 0) {
            cart.splice(idx, 1);
        } else {
            item.total = item.price * item.qty;
        }
        
        updateCartUI();
        
        // å¦‚æœè³¼ç‰©è»Šé‚„æœ‰å•†å“ï¼Œé‡æ–°æ¸²æŸ“æ¸…å–®ï¼›å¦å‰‡é—œé–‰
        if(cart.length > 0) {
            openCartModal(); 
        } else {
            closeCartModal(); 
        }
    }

    function closeCartModal() { document.getElementById('cart-modal').classList.add('hidden'); }
    function closeSpecModal() { document.getElementById('spec-modal').classList.add('hidden'); }
    function clearCart() { cart = []; updateCartUI(); }
    function removeCartItem(idx) { cart.splice(idx, 1); updateCartUI(); if(cart.length > 0) openCartModal(); }

    function preCheckout() {
      if(cart.length===0) { showMsg("è³¼ç‰©è»Šæ˜¯ç©ºçš„"); return; }
      const svcs = currentShop.services || ["è‡ªå–"];
      let html = '';
      svcs.forEach((s,i) => { html += `<div class="service-option ${i===0?'selected':''}" onclick="selSvc(this,'${s}')">${s}</div>`; if(i===0) selectedService = s; });
      document.getElementById('service-options').innerHTML = html;
      document.getElementById('service-modal').classList.remove('hidden');
    }
    function selSvc(el, s) { document.querySelectorAll('.service-option').forEach(e=>e.classList.remove('selected')); el.classList.add('selected'); selectedService = s; }
    
    async function confirmOrder() {
      document.getElementById('service-modal').classList.add('hidden');
      let detail = "", total = 0;
      cart.forEach(x => { detail += `${x.name} x ${x.qty} ($${x.total})\n`; total += x.total; });
      detail += `----------------\nç¸½é‡‘é¡ï¼š$${total} å…ƒ\næœå‹™æ–¹å¼ï¼š${selectedService}`;
      
      let phone = localStorage.getItem("uni_user_phone");
      if(!phone) { phone = prompt("è«‹è¼¸å…¥æ‚¨çš„æ‰‹æ©Ÿè™Ÿç¢¼ï¼š"); if(!phone) return; localStorage.setItem("uni_user_phone", phone); }
      detail += `\n----------------\nğŸ“ è¯çµ¡é›»è©±ï¼š${phone}`;

      showMsg("è™•ç†ä¸­...", null);
      try {
        await liff.sendMessages([{type:"text", text:`ã€Uni-Sã€‘\næˆ‘å‘ ${currentShop.name} ä¸‹å–®äº†ï¼š\n\n${detail}`}]);
        await fetch(API_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({shopId:currentShop.id, userName:userProfile.displayName, userId:userProfile.userId, order:detail})});
        showMsg("âœ… è¨‚å–®å·²é€å‡ºï¼", () => { goLobby(); });
      } catch(e) { showMsg("å¤±æ•—:"+e.message); }
    }

    // è¨‚å–®æ­·å²èˆ‡è©³æƒ…
    async function loadOrderHistory() {
      document.getElementById('history-loading').style.display='block';
      try {
        const res = await fetch(API_URL, {method:'POST', body:JSON.stringify({action:"getHistory", userId:userProfile.userId})});
        orderCache = await res.json();
        document.getElementById('history-loading').style.display='none';
        if(orderCache.length===0) { document.getElementById('history-list').innerHTML = '<div style="text-align:center;color:#999;">ç„¡ç´€éŒ„</div>'; return; }
        let html = '';
        orderCache.forEach((o, i) => {
          let price = o.content.split('ç¸½é‡‘é¡ï¼š')[1]?.split('\n')[0].replace('å…ƒ','').trim() || '';
          let cls = o.status.includes('å·²æ¥å–®')?'status-ok':(o.status.includes('å©‰æ‹’')||o.status.includes('å–æ¶ˆ')?'status-no':'status-wait');
          html += `<div class="history-simple-item" onclick="openOrderDetail(${i})"><div class="hs-info"><div class="hs-shop">${o.shopName}</div><div class="hs-date">${o.time}</div><div class="hs-status ${cls}">${o.status}</div></div><div class="hs-price">${price}</div><div class="hs-arrow">â€º</div></div>`;
        });
        document.getElementById('history-list').innerHTML = html;
      } catch(e) {}
    }
    function openOrderDetail(idx) {
      let o = orderCache[idx];
      document.getElementById('tab-bar').classList.add('hidden');
      ['lobby-view','coupons-view','member-view'].forEach(id=>document.getElementById(id).classList.add('hidden'));
      document.getElementById('order-detail-view').classList.remove('hidden');
      
      document.getElementById('od-shop-name').innerText = o.shopName;
      document.getElementById('od-status').innerText = o.status;
      document.getElementById('od-id').innerText = o.orderId;
      document.getElementById('od-time').innerText = o.time;
      
      let html = '', total = '', phone = '--';
      o.content.split('\n').forEach(line => {
        if(line.includes('ç¸½é‡‘é¡')) total = line.split('ï¼š')[1];
        else if(line.includes('é›»è©±')) phone = line.split('ï¼š')[1];
        else if(!line.includes('---') && line.trim()) html += `<div class="od-item" style="display:flex;justify-content:space-between;margin-bottom:5px;"><div class="od-item-name">${line}</div></div>`;
      });
      document.getElementById('od-items-list').innerHTML = html;
      document.getElementById('od-total-price').innerText = total;
      document.getElementById('od-phone').innerText = phone;
      document.getElementById('od-cancel-container').innerHTML = o.status.includes('å¾…ç¢ºèª') ? `<div class="spec-add-btn" style="background:#fff;color:#D32F2F;border:1px solid #D32F2F;text-align:center;" onclick="cancelOrder('${o.orderId}')">å–æ¶ˆè¨‚å–®</div>` : '';
    }
    function closeOrderDetail() {
      document.getElementById('order-detail-view').classList.add('hidden');
      document.getElementById('member-view').classList.remove('hidden');
      document.getElementById('tab-bar').classList.remove('hidden');
    }
    async function cancelOrder(oid) {
      showConfirm("ç¢ºå®šå–æ¶ˆï¼Ÿ", async () => {
        await fetch(API_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:"cancelOrder", orderId:oid, userId:userProfile.userId})});
        setTimeout(() => { showMsg("å·²é€å‡ºå–æ¶ˆ", () => { closeOrderDetail(); loadOrderHistory(); }); }, 1500);
      });
    }

    // å¤§å»³èˆ‡ API
    function renderLobby(shops) {
      let html = '';
      Object.keys(shops).forEach(id => {
        let s = shops[id];
        html += `<div class="shop-card" onclick="openShop('${id}')"><div class="shop-thumb" style="background-image:url(${s.bannerUrl})"></div><div class="shop-info"><div class="shop-name" style="font-weight:bold;margin-bottom:5px;">${s.name}</div><div class="shop-action"><button class="btn-visit">å»é€›é€›</button></div></div></div>`;
      });
      document.getElementById('shop-list').innerHTML = html;
    }
    function filterShops() {
      let key = document.getElementById('search-input').value.toLowerCase();
      let res = {}; Object.keys(allShops).forEach(k => { if(allShops[k].name.toLowerCase().includes(key)) res[k] = allShops[k]; });
      renderLobby(res);
    }
    function goLobby() { 
      const url = new URL(window.location); url.searchParams.delete('id'); window.history.pushState({}, '', url);
      document.getElementById('shop-view').classList.add('hidden');
      document.getElementById('tab-bar').classList.remove('hidden');
      document.getElementById('lobby-view').classList.remove('hidden');
    }
    async function fetchMemberData() {
      try {
        const res = await fetch(`${API_URL}?action=getMember&userId=${userProfile.userId}`);
        const data = await res.json();
        document.getElementById('m-points').innerText = data.points || 0;
        document.getElementById('home-points').innerText = data.points || 0;
        if(data.name && data.name!=="æœƒå“¡") ['home-name','m-name'].forEach(id=>document.getElementById(id).innerText=data.name);
        window.currentMemberData = data;
      } catch(e) {}
    }
    function openEditModal() {
      const data = window.currentMemberData || {};
      document.getElementById('edit-name').value = data.name || userProfile.displayName;
      document.getElementById('edit-phone').value = data.phone || localStorage.getItem("uni_user_phone") || "";
      if (data.birthday) try { document.getElementById('edit-birthday').value = new Date(data.birthday).toISOString().split('T')[0]; } catch(e){}
      document.getElementById('edit-modal').classList.remove('hidden');
    }
    function closeEditModal() { document.getElementById('edit-modal').classList.add('hidden'); }
    async function saveProfile() {
      const name = document.getElementById('edit-name').value;
      const phone = document.getElementById('edit-phone').value;
      const birthday = document.getElementById('edit-birthday').value;
      if (!name || !phone) { showMsg("å§“åèˆ‡é›»è©±ç‚ºå¿…å¡«"); return; }
      const btn = document.querySelector('.btn-save'); btn.innerText = "å„²å­˜ä¸­...";
      try {
        await fetch(API_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ action: "updateProfile", userId: userProfile.userId, name: name, phone: phone, birthday: birthday }) });
        showMsg("è³‡æ–™æ›´æ–°æˆåŠŸï¼", () => { localStorage.setItem("uni_user_phone", phone); closeEditModal(); fetchMemberData(); });
      } catch(e) { showMsg("æ›´æ–°å¤±æ•—"); } finally { btn.innerText = "å„²å­˜"; }
    }

    main();
  </script>
</body>
</html>
