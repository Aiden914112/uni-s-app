<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Uni-S 茶顏悅色</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root { --primary: #C44E4C; --bg: #F5F5F5; --text: #333; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    
    /* 1. 頭部與門店詳情 */
    .header { background: #fff; padding: 10px 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 100; flex-shrink: 0; }
    .store-info-bar { display: flex; justify-content: space-between; align-items: center; }
    .store-name { font-size: 18px; font-weight: bold; color: #333; display: flex; align-items: center; }
    .store-distance { font-size: 12px; color: #999; margin-left: 5px; }
    .switch-mode { display: flex; background: #eee; border-radius: 20px; padding: 2px; }
    .mode-btn { padding: 4px 12px; font-size: 12px; border-radius: 18px; border: none; background: transparent; color: #666; }
    .mode-btn.active { background: var(--primary); color: #fff; font-weight: bold; }
    
    .store-detail-dropdown { height: 0; overflow: hidden; transition: height 0.3s; background: #fff; font-size: 12px; color: #666; padding: 0 15px; }
    .store-detail-dropdown.open { height: auto; padding-bottom: 10px; border-bottom: 1px solid #eee; }
    .sd-row { display: flex; align-items: center; margin-top: 8px; }
    .sd-icon { width: 20px; text-align: center; margin-right: 8px; color: var(--primary); }

    /* 2. 左右連動菜單 */
    .menu-container { flex: 1; display: flex; overflow: hidden; position: relative; }
    
    /* 左側分類導航 */
    .menu-sidebar { width: 85px; background: #F5F5F5; overflow-y: auto; scrollbar-width: none; }
    .category-item { padding: 15px 5px; font-size: 13px; color: #666; text-align: center; position: relative; cursor: pointer; }
    .category-item.active { background: #fff; color: #333; font-weight: bold; }
    .category-item.active::before { content: ''; position: absolute; left: 0; top: 15px; bottom: 15px; width: 4px; background: var(--primary); border-radius: 0 4px 4px 0; }
    
    /* 右側商品列表 */
    .menu-content { flex: 1; background: #fff; overflow-y: auto; padding: 10px 10px 80px 10px; scroll-behavior: smooth; }
    .category-title { font-size: 14px; font-weight: bold; color: #333; margin: 15px 0 10px 0; padding-left: 5px; }
    
    .product-item { display: flex; margin-bottom: 20px; }
    .prod-img { width: 90px; height: 90px; border-radius: 8px; background-color: #eee; background-size: cover; background-position: center; flex-shrink: 0; }
    .prod-info { flex: 1; padding-left: 10px; display: flex; flex-direction: column; justify-content: space-between; }
    .prod-name { font-size: 16px; font-weight: bold; color: #333; }
    .prod-desc { font-size: 11px; color: #999; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-top: 4px; }
    .prod-tags { display: flex; gap: 4px; margin-top: 4px; }
    .prod-tag { font-size: 10px; border: 1px solid var(--primary); color: var(--primary); padding: 1px 4px; border-radius: 4px; }
    .prod-bottom { display: flex; justify-content: space-between; align-items: flex-end; }
    .prod-price { font-size: 16px; font-weight: bold; color: #333; }
    .btn-add { background: var(--primary); color: #fff; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; }

    /* 3. 規格選擇彈窗 (Product Modal) */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 500; display: none; align-items: flex-end; justify-content: center; }
    .modal-sheet { background: #fff; width: 100%; border-radius: 20px 20px 0 0; max-height: 80vh; overflow-y: auto; animation: slideUp 0.3s; padding-bottom: 20px; }
    .modal-header { position: relative; }
    .modal-img { width: 100%; height: 200px; background-size: cover; background-position: center; }
    .btn-close { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: #fff; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    
    .modal-body { padding: 15px; }
    .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
    .modal-desc { font-size: 12px; color: #888; margin-bottom: 15px; }
    
    .option-group { margin-bottom: 15px; }
    .option-title { font-size: 13px; color: #666; margin-bottom: 8px; }
    .option-chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { padding: 6px 15px; background: #F5F5F5; border-radius: 6px; font-size: 12px; color: #333; cursor: pointer; border: 1px solid transparent; }
    .chip.selected { background: #FEF0F0; color: var(--primary); border-color: var(--primary); }
    
    .modal-footer { padding: 10px 15px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
    .modal-price { font-size: 24px; font-weight: bold; color: #333; }
    .stepper { display: flex; align-items: center; background: #F5F5F5; border-radius: 20px; padding: 2px 4px; }
    .stepper span { font-weight: bold; margin: 0 10px; }
    .btn-cart { background: var(--primary); color: #fff; padding: 10px 30px; border-radius: 30px; font-weight: bold; margin-left: 10px; }

    /* 4. 底部購物車條 */
    .cart-bar { position: fixed; bottom: 20px; left: 15px; right: 15px; background: #333; border-radius: 50px; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; color: #fff; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 200; }
    .cart-info { display: flex; align-items: center; }
    .cart-icon-box { position: relative; margin-right: 15px; }
    .cart-icon { font-size: 24px; color: #fff; }
    .cart-badge { position: absolute; top: -5px; right: -8px; background: #D32F2F; color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 10px; }
    .cart-total { font-size: 18px; font-weight: bold; }
    .btn-checkout { background: var(--primary); color: #fff; padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 14px; }

    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
  </style>
</head>
<body>

  <div class="header">
    <div class="store-info-bar" onclick="toggleStoreDetail()">
      <div class="store-name">茶顏悅色 (旗艦店) <i class="fas fa-chevron-down" style="font-size:12px; margin-left:5px;"></i></div>
      <div class="switch-mode">
        <button class="mode-btn active">自取</button>
        <button class="mode-btn">外送</button>
      </div>
    </div>
    <div class="store-detail-dropdown" id="store-detail">
      <div class="sd-row"><div class="sd-icon"><i class="fas fa-clock"></i></div><div>營業時間：10:00 - 22:00</div></div>
      <div class="sd-row"><div class="sd-icon"><i class="fas fa-phone"></i></div><div>02-1234-5678</div></div>
      <div class="sd-row"><div class="sd-icon"><i class="fas fa-map-marker-alt"></i></div><div>台北市信義區松壽路11號</div></div>
    </div>
  </div>

  <div class="menu-container">
    <div class="menu-sidebar" id="category-list">
      </div>
    
    <div class="menu-content" id="product-list" onscroll="handleScroll()">
      </div>
  </div>

  <div class="cart-bar" id="cart-bar" style="display:none;">
    <div class="cart-info">
      <div class="cart-icon-box">
        <i class="fas fa-shopping-bag cart-icon"></i>
        <div class="cart-badge" id="cart-count">0</div>
      </div>
      <div class="cart-total">$<span id="cart-total">0</span></div>
    </div>
    <div class="btn-checkout" onclick="alert('去結帳')">去結算</div>
  </div>

  <div class="modal-overlay" id="product-modal">
    <div class="modal-sheet">
      <div class="modal-header">
        <div class="modal-img" id="m-img"></div>
        <div class="btn-close" onclick="closeModal()">×</div>
      </div>
      <div class="modal-body">
        <div class="modal-title" id="m-name">...</div>
        <div class="modal-desc" id="m-desc">...</div>
        
        <div id="m-options">
          </div>
      </div>
      <div class="modal-footer">
        <div style="display:flex;align-items:center;">
          <div class="modal-price">$<span id="m-price">0</span></div>
          <div class="stepper" style="margin-left:15px;">
            <div class="btn-add" onclick="updateModalQty(-1)" style="background:#eee;color:#333;">-</div>
            <span id="m-qty">1</span>
            <div class="btn-add" onclick="updateModalQty(1)">+</div>
          </div>
        </div>
        <div class="btn-cart" onclick="addToCart()">加入購物車</div>
      </div>
    </div>
  </div>

  <script>
    // 模擬資料 (請把這段換成從 fetch 取得的 data.menu)
    const menuData = [
      {
        category: "當季主推",
        items: [
          { name: "幽蘭拿鐵", price: 160, img: "https://images.unsplash.com/photo-1546853020-ca4909aef454", desc: "錫蘭紅茶配鮮奶", tags: ["推薦"], options: {"溫度":["冰","熱"], "甜度":["正常","半糖"]} },
          { name: "聲聲烏龍", price: 150, img: "https://images.unsplash.com/photo-1595981267035-7b04ca84a82d", desc: "蜜桃烏龍", tags: [], options: {"溫度":["冰","熱"], "甜度":["全","半"]} }
        ]
      },
      {
        category: "果茶系列",
        items: [
          { name: "鳳梨冰茶", price: 120, img: "https://images.unsplash.com/photo-1621263764928-df1444c5e859", desc: "新鮮鳳梨", tags: [], options: {} },
          { name: "西瓜啵啵", price: 90, img: "https://images.unsplash.com/photo-1599390163353-2777f98f6d72", desc: "西瓜冰沙", tags: [], options: {} }
        ]
      }
    ];

    let currentItem = null;
    let currentOptions = {};
    let currentQty = 1;
    let cart = [];

    // 初始化
    window.onload = function() {
      renderMenu();
    };

    function renderMenu() {
      const catList = document.getElementById('category-list');
      const prodList = document.getElementById('product-list');
      
      menuData.forEach((cat, idx) => {
        // 左側分類
        catList.innerHTML += `<div class="category-item ${idx===0?'active':''}" onclick="scrollToCat(${idx})">${cat.category}</div>`;
        
        // 右側商品
        let itemsHtml = '';
        cat.items.forEach(item => {
          let tagsHtml = item.tags.map(t => `<span class="prod-tag">${t}</span>`).join('');
          itemsHtml += `
            <div class="product-item" onclick='openModal(${JSON.stringify(item)})'>
              <div class="prod-img" style="background-image:url(${item.img})"></div>
              <div class="prod-info">
                <div>
                  <div class="prod-name">${item.name}</div>
                  <div class="prod-desc">${item.desc}</div>
                  <div class="prod-tags">${tagsHtml}</div>
                </div>
                <div class="prod-bottom">
                  <div class="prod-price">$${item.price}</div>
                  <div class="btn-add">+</div>
                </div>
              </div>
            </div>`;
        });
        
        prodList.innerHTML += `<div id="cat-${idx}"><div class="category-title">${cat.category}</div>${itemsHtml}</div>`;
      });
    }

    // 彈窗邏輯
    function openModal(item) {
      currentItem = item;
      currentQty = 1;
      currentOptions = {};
      
      document.getElementById('m-name').innerText = item.name;
      document.getElementById('m-desc').innerText = item.desc;
      document.getElementById('m-price').innerText = item.price;
      document.getElementById('m-img').style.backgroundImage = `url(${item.img})`;
      document.getElementById('m-qty').innerText = 1;
      
      // 生成規格選項
      let optHtml = '';
      for (let [key, values] of Object.entries(item.options || {})) {
        currentOptions[key] = values[0]; // 預設選第一個
        let chips = values.map((v, i) => `<div class="chip ${i===0?'selected':''}" onclick="selectOpt(this, '${key}', '${v}')">${v}</div>`).join('');
        optHtml += `<div class="option-group"><div class="option-title">${key}</div><div class="option-chips">${chips}</div></div>`;
      }
      document.getElementById('m-options').innerHTML = optHtml;
      
      document.getElementById('product-modal').style.display = 'flex';
    }

    function selectOpt(el, key, val) {
      el.parentNode.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
      currentOptions[key] = val;
    }

    function updateModalQty(change) {
      if (currentQty + change > 0) {
        currentQty += change;
        document.getElementById('m-qty').innerText = currentQty;
      }
    }

    function addToCart() {
      // 加入購物車邏輯
      let optStr = Object.values(currentOptions).join('/');
      cart.push({
        name: currentItem.name,
        price: currentItem.price,
        qty: currentQty,
        opts: optStr,
        total: currentItem.price * currentQty
      });
      
      closeModal();
      updateCartBar();
    }

    function updateCartBar() {
      let totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
      let totalPrice = cart.reduce((acc, item) => acc + item.total, 0);
      
      if (totalQty > 0) {
        document.getElementById('cart-bar').style.display = 'flex';
        document.getElementById('cart-count').innerText = totalQty;
        document.getElementById('cart-total').innerText = totalPrice;
      }
    }

    function closeModal() {
      document.getElementById('product-modal').style.display = 'none';
    }

    function toggleStoreDetail() {
      document.getElementById('store-detail').classList.toggle('open');
    }

    function scrollToCat(idx) {
      document.getElementById(`cat-${idx}`).scrollIntoView({behavior: "smooth"});
      // 更新左側 active 狀態 (省略實作)
    }
  </script>
</body>
</html>
