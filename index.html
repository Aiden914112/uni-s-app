<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Uni-S ç”Ÿæ´»åœˆ</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ==================== å…¨å±€è¨­å®š ==================== */
    :root { --primary: #C44E4C; --gold: #C5A674; --bg: #F5F6F7; --text: #333; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 0; margin: 0; background-color: var(--bg); color: var(--text); touch-action: manipulation; -webkit-user-select: none; user-select: none; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
    .hidden { display: none !important; }
    #loading { position: fixed; inset: 0; background: #fff; z-index: 2000; display: flex; justify-content: center; align-items: center; color: #999; flex-direction: column; }

    /* é€šç”¨å½ˆçª— */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: flex-end; justify-content: center; backdrop-filter: blur(2px); }
    .modal-sheet { background: #fff; width: 100%; border-radius: 20px 20px 0 0; max-height: 85vh; overflow-y: auto; animation: slideUp 0.3s; padding-bottom: 20px; position: relative; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    /* ==================== 5. åº—é‹ªé é¢ (Shop) - å¤§å‡ç´š ==================== */
    #shop-view { background: #fff; height: 100%; display: flex; flex-direction: column; position: relative; }
    
    /* A. èŒ¶é¡æ‚…è‰²é¢¨æ ¼é ­éƒ¨ */
    .shop-header-complex { background: #fff; padding: 10px 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); z-index: 20; }
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .store-switch { font-size: 18px; font-weight: bold; color: #333; display: flex; align-items: center; cursor: pointer; }
    .delivery-toggle { display: flex; background: #f0f0f0; border-radius: 20px; padding: 2px; }
    .toggle-btn { padding: 4px 12px; border-radius: 18px; border: none; font-size: 12px; background: transparent; color: #666; }
    .toggle-btn.active { background: var(--primary); color: #fff; font-weight: bold; }
    
    /* ä¸‹æ‹‰è©³æƒ… */
    .store-detail-box { height: 0; overflow: hidden; transition: height 0.3s ease; font-size: 12px; color: #666; }
    .store-detail-box.open { height: auto; padding-top: 10px; border-top: 1px dashed #eee; margin-top: 5px; }
    .detail-row { display: flex; align-items: center; margin-bottom: 5px; }
    .detail-row i { width: 20px; text-align: center; color: var(--primary); margin-right: 5px; }

    /* B. å·¦å³é€£å‹•èœå–®å®¹å™¨ */
    .shop-body { flex: 1; display: flex; overflow: hidden; position: relative; }
    
    /* å·¦å´ */
    .menu-sidebar { width: 85px; background: #F5F5F5; overflow-y: auto; scrollbar-width: none; padding-bottom: 80px; }
    .category-item { padding: 18px 5px; font-size: 13px; color: #666; text-align: center; cursor: pointer; position: relative; }
    .category-item.active { background: #fff; color: #333; font-weight: bold; }
    .category-item.active::before { content: ''; position: absolute; left: 0; top: 15px; bottom: 15px; width: 4px; background: var(--primary); border-radius: 0 4px 4px 0; }
    
    /* å³å´ */
    .menu-content { flex: 1; overflow-y: auto; padding: 0 10px 80px 10px; scroll-behavior: smooth; }
    .category-title { font-size: 13px; font-weight: bold; color: #333; margin: 15px 0 10px 0; padding-left: 5px; }
    .food-item { display: flex; margin-bottom: 20px; }
    .food-img { width: 90px; height: 90px; border-radius: 8px; background-color: #eee; background-size: cover; background-position: center; flex-shrink: 0; }
    .food-info { flex: 1; padding-left: 10px; display: flex; flex-direction: column; justify-content: space-between; }
    .food-name { font-size: 16px; font-weight: bold; color: #333; }
    .food-desc { font-size: 11px; color: #999; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-top: 2px; }
    .food-tags { display: flex; gap: 4px; margin-top: 4px; }
    .food-tag { font-size: 10px; border: 1px solid var(--primary); color: var(--primary); padding: 1px 3px; border-radius: 4px; }
    .food-action { display: flex; justify-content: space-between; align-items: flex-end; }
    .food-price { font-size: 16px; font-weight: bold; color: #333; }
    .btn-add-mini { background: var(--primary); color: #fff; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; }

    /* C. åº•éƒ¨è³¼ç‰©è»Šæ¢ (å¯é»æ“Š) */
    .cart-bar { position: absolute; bottom: 20px; left: 15px; right: 15px; background: #333; border-radius: 50px; padding: 0; display: flex; justify-content: space-between; align-items: center; color: #fff; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 100; height: 50px; cursor: pointer; }
    .cart-left { flex: 1; display: flex; align-items: center; padding-left: 20px; height: 100%; }
    .cart-icon-wrapper { position: relative; margin-right: 15px; }
    .cart-icon { font-size: 24px; color: #fff; }
    .cart-badge { position: absolute; top: -8px; right: -8px; background: #D32F2F; color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 10px; }
    .cart-price { font-size: 18px; font-weight: bold; }
    .btn-checkout { background: var(--primary); color: #fff; border: none; height: 100%; padding: 0 30px; border-radius: 0 50px 50px 0; font-weight: bold; font-size: 16px; display: flex; align-items: center; }

    /* D. è³¼ç‰©è»Šæ˜ç´°å½ˆçª— (Cart Modal) */
    .cart-list { padding: 0 15px; max-height: 50vh; overflow-y: auto; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f5f5f5; }
    .cart-item-name { font-size: 15px; font-weight: bold; color: #333; }
    .cart-item-opts { font-size: 12px; color: #999; margin-top: 2px; }
    .cart-item-right { display: flex; align-items: center; gap: 15px; }
    .cart-item-price { font-weight: bold; color: #333; }
    .btn-del { color: #ccc; font-size: 18px; padding: 5px; }

    /* E. è¦æ ¼é¸æ“‡å½ˆçª— (Spec Modal) */
    .spec-header { padding: 15px; display: flex; gap: 15px; }
    .spec-img { width: 80px; height: 80px; border-radius: 8px; background-color: #eee; background-size: cover; background-position: center; }
    .spec-options { padding: 0 15px 15px 15px; max-height: 40vh; overflow-y: auto; }
    .option-group { margin-bottom: 15px; }
    .option-title { font-size: 13px; color: #666; margin-bottom: 8px; }
    .option-chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { padding: 6px 15px; background: #F5F5F5; border-radius: 6px; font-size: 12px; color: #333; border: 1px solid transparent; cursor: pointer; }
    .chip.selected { background: #FEF0F0; color: var(--primary); border-color: var(--primary); }
    .spec-footer { border-top: 1px solid #eee; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    .spec-add-btn { background: var(--primary); color: #fff; padding: 10px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; }
    
    .stepper { display: flex; align-items: center; background: #f5f5f5; border-radius: 20px; padding: 2px 8px; }
    .stepper button { width: 28px; height: 28px; border-radius: 50%; border: none; font-size: 18px; cursor: pointer; }

    /* è¿”å›æ‡¸æµ®éˆ• */
    .float-back { position: fixed; top: 15px; left: 15px; width: 36px; height: 36px; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; z-index: 200; cursor: pointer; }

    /* å…¶ä»–é é¢æ¨£å¼ (Lobby, Member) ä¿æŒç²¾ç°¡ï¼Œé¿å…è¡çª */
    #lobby-view { padding: 15px; overflow-y: auto; height: 100%; padding-bottom: 80px; }
    /* ... (é€™è£¡çœç•¥éƒ¨åˆ†å¤§å»³æ¨£å¼ï¼Œä½¿ç”¨ä½ åŸæœ¬çš„å³å¯ï¼Œé€™ä»½ä»£ç¢¼æœƒèšç„¦ä¿®å¾© Shop) ... */
    /* ç‚ºäº†ç¢ºä¿å®Œæ•´é‹è¡Œï¼Œæˆ‘æŠŠå¤§å»³çš„é—œéµæ¨£å¼è£œä¸Š */
    .lobby-header-bg { background: linear-gradient(135deg, #2c3e50, #000); height: 160px; border-radius: 0 0 20px 20px; padding: 20px; color: var(--gold); flex-shrink: 0;}
    .shop-card { background: #fff; border-radius: 12px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; padding: 10px; cursor: pointer; }
    .shop-thumb { width: 80px; height: 80px; background-size: cover; border-radius: 8px; flex-shrink: 0; }
    .shop-info { padding-left: 15px; flex: 1; display: flex; flex-direction: column; justify-content: center; }
    
    /* æœå‹™é¸æ“‡å½ˆçª— */
    #service-modal .service-sheet { padding: 20px; }
    .service-option { padding: 15px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; text-align: center; font-weight: bold; }
    .service-option.selected { border-color: var(--primary); background: #f0f9f0; color: var(--primary); }

  </style>
</head>
<body>

  <div id="loading">è¼‰å…¥ä¸­...</div>

  <div id="lobby-view" class="hidden">
    <div class="lobby-header-bg">
      <div style="font-weight:bold; font-size:12px; opacity:0.8;">UNI-S PLATFORM</div>
      <div style="font-size:20px; font-weight:bold; margin-top:5px; color:#fff;">æ¢ç´¢ç¾å¥½ç”Ÿæ´»</div>
    </div>
    <div id="shop-list" style="padding: 20px 15px;"></div>
  </div>

  <div id="shop-view" class="hidden">
    <div class="float-back" onclick="goLobby()"><i class="fas fa-chevron-left"></i></div>
    
    <div class="shop-header-complex">
      <div class="header-top">
        <div class="store-switch" onclick="toggleDetail()">
          <span id="shop-name">...</span> <i class="fas fa-caret-down" style="margin-left:5px; font-size:14px;"></i>
        </div>
        <div class="delivery-toggle">
          <button class="toggle-btn active">è‡ªå–</button>
          <button class="toggle-btn">å¤–é€</button>
        </div>
      </div>
      <div class="store-detail-box" id="store-detail">
        <div class="detail-row"><i class="fas fa-clock"></i> ç‡Ÿæ¥­æ™‚é–“ï¼š10:00 - 22:00</div>
        <div class="detail-row"><i class="fas fa-phone"></i> 02-2345-6789</div>
        <div class="detail-row"><i class="fas fa-map-marker-alt"></i> å°åŒ—å¸‚ä¿¡ç¾©å€...</div>
      </div>
    </div>

    <div class="shop-body">
      <div class="menu-sidebar" id="food-sidebar"></div>
      <div class="menu-content" id="food-content"></div>
    </div>

    <div id="cart-bar" class="cart-bar" style="display:none;">
      <div class="cart-left" onclick="openCartModal()">
        <div class="cart-icon-wrapper">
          <i class="fas fa-shopping-bag cart-icon"></i>
          <div class="cart-badge" id="cart-count">0</div>
        </div>
        <div class="cart-price">$<span id="cart-total">0</span></div>
      </div>
      <div class="btn-checkout" onclick="preCheckout()">å»çµç®—</div>
    </div>
  </div>

  <div id="spec-modal" class="modal-overlay hidden">
    <div class="modal-sheet">
      <div style="text-align:right; padding:10px;"><i class="fas fa-times" onclick="closeSpecModal()" style="font-size:20px; color:#999;"></i></div>
      <div class="spec-header">
        <div class="spec-img" id="sp-img"></div>
        <div style="flex:1;">
          <div style="font-size:18px; font-weight:bold;" id="sp-name"></div>
          <div style="font-size:12px; color:#888; margin-top:5px;" id="sp-desc"></div>
        </div>
      </div>
      <div id="sp-options" class="spec-options"></div>
      <div class="spec-footer">
        <div style="display:flex;align-items:center;">
          <div style="font-size:20px;font-weight:bold;color:#333;margin-right:15px;">$<span id="sp-price">0</span></div>
          <div class="stepper">
            <button onclick="updateSpQty(-1)">-</button>
            <span id="sp-qty" style="margin:0 10px;font-weight:bold;">1</span>
            <button onclick="updateSpQty(1)">+</button>
          </div>
        </div>
        <div class="spec-add-btn" onclick="addSpecToCart()">åŠ å…¥è³¼ç‰©è»Š</div>
      </div>
    </div>
  </div>

  <div id="cart-modal" class="modal-overlay hidden">
    <div class="modal-sheet" style="padding:0;">
      <div style="background:#f5f5f5; padding:10px 15px; font-size:12px; color:#666; display:flex; justify-content:space-between;">
        <span>å·²é¸å•†å“</span>
        <span onclick="clearCart()" style="cursor:pointer;"><i class="fas fa-trash"></i> æ¸…ç©º</span>
      </div>
      <div id="cart-list" class="cart-list"></div>
      <div style="height:20px;" onclick="closeCartModal()"></div>
    </div>
  </div>

  <div id="service-modal" class="modal-overlay hidden">
    <div class="service-sheet">
      <div style="text-align:center; font-weight:bold; font-size:18px; margin-bottom:20px;">é¸æ“‡ç”¨é¤æ–¹å¼</div>
      <div id="service-options"></div>
      <div class="spec-add-btn" style="text-align:center; margin-top:15px;" onclick="confirmOrder()">ç¢ºèªä¸‹å–®</div>
    </div>
  </div>

  <script>
    // âš ï¸âš ï¸âš ï¸ ID å¡«é€™è£¡ âš ï¸âš ï¸âš ï¸
    const MY_LIFF_ID = "2008590518-p2AoVQO2"; 
    const API_URL = "https://script.google.com/macros/s/AKfycbzxUYXVSMjF8Zt7KqBo9qGvottN4zoxkM1qCu97ZqugJ7Nf6czxu0DzBY9DN1nVRtdn/exec";

    let allShops = {}; let currentShop = null; let cart = []; let userProfile = null;
    let currentItem = null; let currentOptions = {}; let currentQty = 1; let selectedService = "";

    async function main() {
      try {
        await liff.init({ liffId: MY_LIFF_ID });
        if (!liff.isLoggedIn()) { liff.login(); return; }
        userProfile = await liff.getProfile();

        const res = await fetch(API_URL);
        allShops = await res.json();
        document.getElementById('loading').classList.add('hidden');

        const shopId = new URLSearchParams(window.location.search).get('id');
        if (shopId && allShops[shopId]) openShop(shopId);
        else renderLobby();

      } catch (err) { alert(err.message); }
    }

    // å¤§å»³
    function renderLobby() {
      document.getElementById('lobby-view').classList.remove('hidden');
      document.getElementById('shop-view').classList.add('hidden');
      let html = '';
      Object.keys(allShops).forEach(id => {
        let s = allShops[id];
        html += `
          <div class="shop-card" onclick="openShop('${id}')">
            <div class="shop-thumb" style="background-image:url(${s.bannerUrl})"></div>
            <div class="shop-info"><div class="shop-name">${s.name}</div><div class="btn-visit" style="width:fit-content;">é€²åº—</div></div>
          </div>`;
      });
      document.getElementById('shop-list').innerHTML = html;
    }

    function openShop(id) {
      currentShop = allShops[id]; currentShop.id = id; cart = []; updateCartUI();
      document.getElementById('lobby-view').classList.add('hidden');
      document.getElementById('shop-view').classList.remove('hidden');
      
      document.getElementById('shop-name').innerText = currentShop.name;
      
      // æ¸²æŸ“åˆ†é¡èˆ‡å•†å“ (èŒ¶é£²æ¨¡å¼)
      const catList = document.getElementById('food-sidebar');
      const prodList = document.getElementById('food-content');
      catList.innerHTML = ''; prodList.innerHTML = '';
      
      let menu = Array.isArray(currentShop.menu) && currentShop.menu[0].category ? currentShop.menu : [{category:"å…¨éƒ¨", items:currentShop.menu}];
      
      menu.forEach((cat, idx) => {
        // å·¦å´åˆ†é¡
        catList.innerHTML += `<div class="category-item ${idx===0?'active':''}" id="cat-btn-${idx}" onclick="scrollToCat(${idx})">${cat.category}</div>`;
        
        // å³å´å•†å“
        let itemsHtml = '';
        cat.items.forEach(item => {
          let itemJson = JSON.stringify(item).replace(/"/g, '&quot;');
          let tagsHtml = (item.tags||[]).map(t=>`<span class="food-tag">${t}</span>`).join('');
          itemsHtml += `
            <div class="food-item" onclick="openSpecModal(${itemJson})">
              <div class="food-img" style="background-image:url(${item.img||currentShop.bannerUrl})"></div>
              <div class="food-info">
                <div><div class="food-name">${item.name}</div><div class="food-desc">${item.desc||''}</div><div class="food-tags">${tagsHtml}</div></div>
                <div class="food-action"><div class="food-price">$${item.price}</div><div class="btn-add-mini">+</div></div>
              </div>
            </div>`;
        });
        prodList.innerHTML += `<div id="cat-sec-${idx}" class="cat-section"><div class="category-title">${cat.category}</div>${itemsHtml}</div>`;
      });

      // ğŸ”¥ å•Ÿå‹•æ»¾å‹•ç›£è½ (é€£å‹•æ•ˆæœæ ¸å¿ƒ)
      prodList.addEventListener('scroll', onScrollContent);
    }

    // ğŸ”¥ æ»¾å‹•é€£å‹•é‚è¼¯
    function onScrollContent() {
      const container = document.getElementById('food-content');
      const sections = document.querySelectorAll('.cat-section');
      let currentIdx = 0;
      
      sections.forEach((sec, idx) => {
        if (sec.offsetTop - container.offsetTop <= container.scrollTop + 50) {
          currentIdx = idx;
        }
      });
      
      document.querySelectorAll('.category-item').forEach(el => el.classList.remove('active'));
      document.getElementById(`cat-btn-${currentIdx}`).classList.add('active');
    }

    function scrollToCat(idx) {
      const target = document.getElementById(`cat-sec-${idx}`);
      document.getElementById('food-content').scrollTo({ top: target.offsetTop - document.getElementById('food-content').offsetTop, behavior: 'smooth' });
    }

    // è¦æ ¼å½ˆçª—
    function openSpecModal(item) {
      currentItem = item; currentQty = 1; currentOptions = {};
      document.getElementById('sp-name').innerText = item.name;
      document.getElementById('sp-desc').innerText = item.desc||'';
      document.getElementById('sp-price').innerText = item.price;
      document.getElementById('sp-img').style.backgroundImage = `url(${item.img||currentShop.bannerUrl})`;
      document.getElementById('sp-qty').innerText = 1;
      
      let html = '';
      for (let [k, vals] of Object.entries(item.options||{})) {
        currentOptions[k] = vals[0];
        let chips = vals.map((v,i) => `<div class="chip ${i===0?'selected':''}" onclick="selOpt(this,'${k}','${v}')">${v}</div>`).join('');
        html += `<div class="option-group"><div class="option-title">${k}</div><div class="option-chips">${chips}</div></div>`;
      }
      document.getElementById('sp-options').innerHTML = html || '<div style="color:#999;font-size:12px;">ç„¡è¦æ ¼é¸é …</div>';
      document.getElementById('spec-modal').classList.remove('hidden');
    }
    
    function selOpt(el, k, v) {
      el.parentNode.querySelectorAll('.chip').forEach(c=>c.classList.remove('selected'));
      el.classList.add('selected'); currentOptions[k] = v;
    }
    
    function updateSpQty(n) { 
      if(currentQty+n > 0) { currentQty+=n; document.getElementById('sp-qty').innerText=currentQty; document.getElementById('sp-price').innerText=currentItem.price*currentQty; } 
    }
    
    function addSpecToCart() {
      let opts = Object.values(currentOptions).join('/');
      if(opts) opts = `(${opts})`;
      // é€™è£¡ä½¿ç”¨ push è€Œä¸æ˜¯åˆä½µï¼Œå› ç‚ºå®¢è£½åŒ–å¯èƒ½ä¸åŒ
      cart.push({name: currentItem.name + " " + opts, price: currentItem.price, qty: currentQty, total: currentItem.price*currentQty});
      document.getElementById('spec-modal').classList.add('hidden');
      updateCartUI();
    }

    // ğŸ”¥ è³¼ç‰©è»Šç®¡ç† (æ˜ç´°å½ˆçª—)
    function updateCartUI() {
      let totalQty = cart.reduce((a,b)=>a+b.qty,0);
      let totalPrice = cart.reduce((a,b)=>a+b.total,0);
      
      if(totalQty > 0) {
        document.getElementById('cart-bar').style.display = 'flex';
        document.getElementById('cart-count').innerText = totalQty;
        document.getElementById('cart-total').innerText = totalPrice;
      } else {
        document.getElementById('cart-bar').style.display = 'none';
        closeCartModal();
      }
    }

    function openCartModal() {
      if(cart.length===0) return;
      const list = document.getElementById('cart-list');
      let html = '';
      cart.forEach((item, idx) => {
        html += `
          <div class="cart-item">
            <div>
              <div class="cart-item-name">${item.name}</div>
              <div class="cart-item-opts">$${item.price} x ${item.qty}</div>
            </div>
            <div class="cart-item-right">
              <div class="cart-item-price">$${item.total}</div>
              <div class="btn-del" onclick="removeCartItem(${idx})"><i class="fas fa-trash-alt"></i></div>
            </div>
          </div>`;
      });
      list.innerHTML = html;
      document.getElementById('cart-modal').classList.remove('hidden');
    }

    function closeCartModal() { document.getElementById('cart-modal').classList.add('hidden'); }
    function clearCart() { cart = []; updateCartUI(); }
    
    function removeCartItem(idx) {
      cart.splice(idx, 1);
      updateCartUI();
      if(cart.length > 0) openCartModal(); // é‡æ–°æ¸²æŸ“åˆ—è¡¨
    }

    // çµå¸³æµç¨‹
    function preCheckout() {
      const svcs = currentShop.services || ["è‡ªå–"];
      let html = '';
      svcs.forEach((s,i) => {
        html += `<div class="service-option ${i===0?'selected':''}" onclick="selSvc(this,'${s}')">${s}</div>`;
        if(i===0) selectedService = s;
      });
      document.getElementById('service-options').innerHTML = html;
      document.getElementById('service-modal').classList.remove('hidden');
    }
    
    function selSvc(el, s) {
      document.querySelectorAll('.service-option').forEach(e=>e.classList.remove('selected'));
      el.classList.add('selected'); selectedService = s;
    }

    async function confirmOrder() {
      document.getElementById('service-modal').classList.add('hidden');
      
      let detail = "", total = 0;
      cart.forEach(x => { detail += `${x.name} x ${x.qty} ($${x.total})\n`; total += x.total; });
      detail += `----------------\nç¸½é‡‘é¡ï¼š$${total} å…ƒ\næœå‹™æ–¹å¼ï¼š${selectedService}`;
      
      let phone = localStorage.getItem("uni_user_phone");
      if(!phone) { phone = prompt("è«‹è¼¸å…¥æ‚¨çš„æ‰‹æ©Ÿè™Ÿç¢¼ï¼š"); if(!phone) return; localStorage.setItem("uni_user_phone", phone); }
      detail += `\n----------------\nğŸ“ è¯çµ¡é›»è©±ï¼š${phone}`;

      try {
        await liff.sendMessages([{type:"text", text:`ã€Uni-Sã€‘\næˆ‘å‘ ${currentShop.name} ä¸‹å–®äº†ï¼š\n\n${detail}`}]);
        await fetch(API_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({shopId:currentShop.id, userName:userProfile.displayName, userId:userProfile.userId, order:detail})});
        alert("âœ… è¨‚å–®å·²é€å‡ºï¼"); goLobby();
      } catch(e) { alert("å¤±æ•—:"+e.message); }
    }

    function goLobby() { window.location.href = window.location.pathname; } // ç°¡å–®é‡æ•´å›é¦–é 
    function toggleDetail() { document.getElementById('store-detail').classList.toggle('open'); }
    function closeSpecModal() { document.getElementById('spec-modal').classList.add('hidden'); }

    main();
  </script>
</body>
</html>
